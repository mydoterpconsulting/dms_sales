{
 "creation": "2026-02-15 22:00:00.000000",
 "docstatus": 0,
 "doctype": "Client Script",
 "dt": "PAR",
 "enabled": 1,
 "idx": 0,
 "modified": "2026-02-15 22:00:00.000000",
 "modified_by": "amirul.zulkefli@mydotconsulting.com",
 "module": "DMS Sales",
 "name": "Calculate Insurance in PAR",
 "owner": "amirul.zulkefli@mydotconsulting.com",
 "script": "frappe.ui.form.on('PAR', {\n    refresh: function(frm) {\n        \n        frm.cscript['govt_approved_net_selling_price'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['gasa'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['metallic_paint'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['carrier_license__inspection_fee'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['accessory_package1'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['total_additional_perodua_accessories_apa'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['admin_handling_charges'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['installation_cost'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['promotional_discount'] = function() {\n            calculateSub(frm);\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['sub_total'] = function() {\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['road_tax'] = function() {\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['registration_fee'] = function() {\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['hp_ownership_claim'] = function() {\n            calculateTotalSales(frm);\n        };\n\n        frm.cscript['insurance_premium'] = function() {\n            calculateTotalSales(frm);\n        };\n        \n        frm.cscript['from_finance_company'] = function() {\n            calculateTotalSales(frm);\n        };\n\n        // Event listener for amount_financed field\n        frm.cscript['amount_financed'] = function() {\n            updateFinanceCompany(frm);\n        };\n        \n        frm.cscript['date_issued'] = function() {\n            calculateTotalSales(frm);\n        };\n        \n        frm.cscript['engine_cc'] = function() {\n            calculateTotalSales(frm);\n        };\n        \n        frm.cscript['from_to_customer'] = function() {\n            calculateTotalSales(frm);\n        };\n         frm.cscript['amount_financed'] = function() {\n            calculateTotalSales(frm);\n        };\n        \n        \n        \n        \n        \n        \n        \n    }\n});\n\n// Function to calculate sub_total based on net_selling_price and additional_perodua_accessories\nfunction calculateSub(frm) {\n    var govt_approved_net_selling_price = frm.doc.govt_approved_net_selling_price || 0;\n    var gasa = frm.doc.gasa || 0;\n    var metallic_paint = frm.doc.metallic_paint || 0;\n    var carrier_license__inspection_fee = frm.doc.carrier_license__inspection_fee || 0;\n    var accessory_package1 = frm.doc.accessory_package1 || 0;\n    var total_additional_perodua_accessories_apa = frm.doc.total_additional_perodua_accessories_apa || 0;\n    var admin_handling_charges = frm.doc.admin_handling_charges || 0;\n    var installation_cost = frm.doc.installation_cost || 0;\n    var promotional_discount = frm.doc.promotional_discount || 0;\n\n    // Perform the calculation\n    var subTotal = govt_approved_net_selling_price + gasa + metallic_paint + carrier_license__inspection_fee + accessory_package1 + total_additional_perodua_accessories_apa + admin_handling_charges + installation_cost + promotional_discount;\n    // Set the calculated value to the sub_total field\n    frm.set_value('sub_total', subTotal);\n    frm.set_value('sub_total_sales_price', subTotal);\n}\n\n// Function to calculate total_sales_price based on sub_total and other fields\nfunction calculateTotalSales(frm) {\n    var subTotal = frm.doc.sub_total || 0;\n    var road_tax = frm.doc.road_tax || 0;\n    var registration_fee = frm.doc.registration_fee || 0;\n    var hp_ownership_claim = frm.doc.hp_ownership_claim || 0;\n    var insurance_premium = frm.doc.insurance_premium || 0;\n    var accessory_package1 = frm.doc.accessory_package1 || 0;\n    var from_finance_company = frm.doc.from_finance_company || 0;\n    var date_issued = frm.doc.date_issued || 0;\n    var engine_cc = frm.doc.engine_cc || 0;\n    var amount_financed = frm.doc.amount_financed || 0;\n    \n\n    // Calculate period_of_takaful_to\n    var periodOfTakafulFrom = new Date(date_issued);\n    var periodOfTakafulTo = new Date(periodOfTakafulFrom);\n    periodOfTakafulTo.setFullYear(periodOfTakafulTo.getFullYear() + 1);\n   \n\n    // Perform the calculation\n    var totalSalesPrices = subTotal + road_tax + registration_fee + hp_ownership_claim + insurance_premium + accessory_package1;\n    frm.set_value('from_finance_company', amount_financed);\n    var fromCustomer = totalSalesPrices - from_finance_company;\n    \n   var roundedTotalSalesPrices = Math.round(totalSalesPrices / 1000) * 1000;\n   var sum_covereds = roundedTotalSalesPrices - 3000;\n    // Set the calculated value to the total_sales_price field\n    frm.set_value('total_sales_price', totalSalesPrices);\n    frm.set_value('net_invoice_value', totalSalesPrices);\n    frm.set_value('total_amount_due', totalSalesPrices);\n     frm.set_value('sum_covered', sum_covereds);\n    frm.set_value('from_to_customer', fromCustomer);\n    frm.set_value('period_of_takaful_from', date_issued);\n    // Set the calculated value to the period_of_takaful_to field\n    frm.set_value('period_of_takaful_to', periodOfTakafulTo);\n    frm.set_value('cubic_capacity', engine_cc);\n    // frm.set_value('amount', fromCustomer);\n    \n    \n}\n\n// Function to update from_finance_company based on amount_financed\n// function updateFinanceCompany(frm) {\n//     var amount_financed = frm.doc.amount_financed || 0;\n//     frm.set_value('from_finance_company', amount_financed);\n// }",
 "view": "Form"
}
